var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e),s=i.prototype;return s.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},s.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},s.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},s.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},s.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},s.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},s.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},s.createGameScene=function(){var t=new material.GameContainer;this.addChild(t)},s.createGameBackground=function(){var t=new egret.Bitmap;t.texture=RES.getRes("map_png"),t.fillMode=egret.BitmapFillMode.REPEAT,t.width=750,t.height=750,this.addChild(t)},e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var material;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var e=new egret.Bitmap;e.texture=RES.getRes("map_png"),e.fillMode=egret.BitmapFillMode.REPEAT,e.width=this.stageW,e.height=this.stageW,this.addChild(e)},e}(egret.DisplayObjectContainer);t.BgMap=e,egret.registerClass(e,"material.BgMap")}(material||(material={}));var material;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var e=new egret.Shape;e.x=150,e.y=this.stageW+200,e.graphics.beginFill(14540253,1),e.graphics.drawCircle(0,0,100),e.graphics.endFill(),this.addChild(e)},e}(egret.DisplayObjectContainer);t.CtrlLever=e,egret.registerClass(e,"material.CtrlLever")}(material||(material={}));var material;!function(t){var e=function(e){function i(){e.call(this),this.shadows=[],this._touchStatus=!1,this._lastTime=egret.getTimer(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(i,e);var s=(__define,i),n=s.prototype;return n.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},n.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.gameWrap=new t.GameWrap,this.addChild(this.gameWrap),this.bg=new t.BgMap,this.addChild(this.bg),this.ctrlLever=new t.CtrlLever,this.addChild(this.ctrlLever),this.ctrlLever.touchEnabled=!0,this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchStart,this),this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.gameStart,this),this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.ctrlLever.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.touchEnd,this),this.gameWrap.touchEnabled=!0,this.gameWrap.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.gameWrap.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.touchEnd,this),this._ctrlGuide=new egret.Shape,this._ctrlGuide.x=150,this._ctrlGuide.y=this.stageW+200,this._ctrlGuide.graphics.beginFill(2856673,1),this._ctrlGuide.graphics.drawCircle(0,0,50),this._ctrlGuide.graphics.endFill(),this._ctrlGuide.alpha=0,this.addChild(this._ctrlGuide),this.pumpkin=new t.Pumpkin,this.addChild(this.pumpkin)},n.touchStart=function(t){console.log("touchStart"),this._touchStatus=!0,this._ctrlGuide.alpha=1,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this)},n.touchEnd=function(t){this._touchStatus=!1,this._ctrlGuide.alpha=0,this.pumpkin.speedX=0,this.pumpkin.speedY=0,this.pumpkin.seStop()},n.touchMove=function(t){if(this._touchStatus){var e=150,i=this.stageW+200,s=100,n=t.stageX,r=t.stageY,a=n,h=r,o=Math.sqrt(Math.pow(e-n,2)+Math.pow(i-r,2));o>s&&(n>e&&i>r&&(a=e+100*(n-e)/o,h=i+100*(r-i)/o),e>n&&i>r&&(a=e-100*(e-n)/o,h=i+100*(r-i)/o),e>n&&r>i&&(a=e-100*(e-n)/o,h=i+100*(r-i)/o),n>e&&r>i&&(a=e+100*(n-e)/o,h=i+100*(r-i)/o)),this._ctrlGuide.x=a,this._ctrlGuide.y=h,n>e&&i>r&&(this.pumpkin.speedX=this.pumpkin.speed*(n-e)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(r-i)*100/o,this.pumpkin.setRunRight()),e>n&&i>r&&(this.pumpkin.speedX=-this.pumpkin.speed*(e-n)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(r-i)*100/o,this.pumpkin.setRunLeft()),e>n&&r>i&&(this.pumpkin.speedX=-this.pumpkin.speed*(e-n)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(r-i)*100/o,this.pumpkin.setRunLeft()),n>e&&r>i&&(this.pumpkin.speedX=this.pumpkin.speed*(n-e)*100/o,this.pumpkin.speedY=this.pumpkin.speed*(r-i)*100/o,this.pumpkin.setRunRight())}},n.gameStart=function(){this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this)},n.gameViewUpdate=function(t){var e=egret.getTimer(),i=(1e3/(e-this._lastTime),e-this._lastTime);this._lastTime=e;this.drawPumpkin(i)},n.drawPumpkin=function(t){if(!(t>100)){var e=this.pumpkin.speedX*t/1e3,i=this.pumpkin.speedY*t/1e3;this.pumpkin.x=this.pumpkin.x+e,this.pumpkin.y=this.pumpkin.y+i,console.log(this.pumpkin.x,this.pumpkin.y),this.pumpkin.x<this.pumpkin.width/2-this.stageW/2&&(this.pumpkin.x=this.pumpkin.width/2-this.stageW/2),this.pumpkin.y<this.pumpkin.height/2-this.stageW/2&&(this.pumpkin.y=this.pumpkin.height/2-this.stageW/2),this.pumpkin.x>this.stageW/2-this.pumpkin.width/2&&(this.pumpkin.x=this.stageW/2-this.pumpkin.width/2),this.pumpkin.y>this.stageW/2-this.pumpkin.height/2&&(this.pumpkin.y=this.stageW/2-this.pumpkin.height/2),this.pumpkin.walked+=Math.sqrt(e*e+i*i)}},i}(egret.DisplayObjectContainer);t.GameContainer=e,egret.registerClass(e,"material.GameContainer")}(material||(material={}));var material;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var e=new egret.Shape;e.graphics.beginFill(16777215,1),e.graphics.drawRect(0,0,this.stageW,this.stageH),e.graphics.endFill(),this.addChild(e)},e}(egret.DisplayObjectContainer);t.GameWrap=e,egret.registerClass(e,"material.GameWrap")}(material||(material={}));var material;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.speed=2;var e=RES.getRes("cat_json"),i=RES.getRes("cat_png"),s=new egret.MovieClipDataFactory(e,i);this.runner=new egret.MovieClip(s.generateMovieClipData("cat")),this.runner.x=this.stageW/2-this.runner.width/2,this.runner.y=this.stageW/2-this.runner.height/2,this.seStop(),this.addChild(this.runner)},s.setRunRight=function(){"right"!=this.runnerState&&(this.runnerState="right",this.runner.x=this.stageW/2-this.runner.width/2,this.runner.y=this.stageW/2-this.runner.height/2,this.runner.scaleX=1,this.runner.gotoAndPlay("run",-1))},s.setRunLeft=function(){"left"!=this.runnerState&&(this.runnerState="left",this.runner.x=this.stageW/2+this.runner.width/2,this.runner.y=this.stageW/2-this.runner.height/2,this.runner.scaleX=-1,this.runner.gotoAndPlay("run",-1))},s.seStop=function(){"stop"!=this.runnerState&&(this.runnerState="stop",this.runner.gotoAndPlay("stop",-1))},e}(egret.DisplayObjectContainer);t.Pumpkin=e,egret.registerClass(e,"material.Pumpkin")}(material||(material={}));var material;!function(t){var e=function(t){function e(){t.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(e,t);var i=(__define,e),s=i.prototype;return s.onAddToStage=function(t){this.drawShadow(this.x,this.y,this.offsetY,5)},s.drawShadow=function(t,e,i,s){var n=new egret.Shape;n.graphics.beginFill(3355443);var r=i>s?1/i:1/s;n.graphics.moveTo(t+i,e);for(var a=0;a<2*Math.PI;a+=r)n.graphics.lineTo(t+i*Math.cos(a),e+s*Math.sin(a));n.graphics.endFill(),this.addChild(n)},e}(egret.DisplayObjectContainer);t.Shadow=e,egret.registerClass(e,"material.Shadow")}(material||(material={}));